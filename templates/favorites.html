{% extends "base.html" %}

{% block title %}æˆ‘çš„æ”¶è— - å¸Œå®é˜…è¯»{% endblock %}

{% block navigation %}
<nav class="breadcrumb">
    <a href="{{ url_for('index') }}" class="nav-link">ğŸ  é¦–é¡µ</a>
    <span class="separator">></span>
    <a href="{{ url_for('favorites_page') }}" class="nav-link current">â­ æˆ‘çš„æ”¶è—</a>
</nav>
{% endblock %}

{% block content %}
<div class="favorites-container">
    <h2>â­ æˆ‘çš„æ”¶è—</h2>

    <div id="favorites-list-container" class="file-browser" style="margin-top: 20px;">
        <!-- Favorite items will be loaded here by JavaScript -->
    </div>

    <p id="empty-favorites-message" style="display:none; text-align:center; margin-top: 30px; font-size: 1.1em;">
        æ‚¨è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•ä¹¦ç±ã€‚å»æ–‡ä»¶åˆ—è¡¨çœ‹çœ‹å§ï¼
    </p>
</div>
{% endblock %}

{% block scripts %}
{{ super() }} {# This ensures scripts from base.html (like favorites.js and theme.js) are included #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const favoritesListContainer = document.getElementById('favorites-list-container');
    const emptyMessage = document.getElementById('empty-favorites-message');
    const favorites = favoritesManager.getFavorites();

    function renderFavorites() {
        favoritesListContainer.innerHTML = ''; // Clear previous items

        if (favorites.length === 0) {
            if (emptyMessage) emptyMessage.style.display = 'block';
            if (favoritesListContainer) favoritesListContainer.style.display = 'none';
            return;
        }

        if (emptyMessage) emptyMessage.style.display = 'none';
        if (favoritesListContainer) favoritesListContainer.style.display = 'block';

        favorites.forEach(filePath => {
            const fileName = filePath.split('/').pop();
            const fileItemDiv = document.createElement('div');
            fileItemDiv.className = 'file-item file'; // Use existing styles

            // Simplified structure compared to index.html, can be expanded
            fileItemDiv.innerHTML = `
                <div class="file-info">
                    <span class="file-icon">ğŸ“„</span>
                    <span class="file-name">${fileName}</span>
                </div>
                <div class="file-actions">
                    <a href="/read?path=${encodeURIComponent(filePath)}" class="btn btn-primary">ğŸ“– é˜…è¯»</a>
                    <button class="btn btn-favorite remove-from-fav" data-filepath="${filePath}" title="å–æ¶ˆæ”¶è—">
                        <span class="favorite-icon">â˜…</span> <!-- Assuming it's favorited if listed here -->
                    </button>
                </div>
            `;

            favoritesListContainer.appendChild(fileItemDiv);
        });

        // Add event listeners to new "remove" buttons
        favoritesListContainer.querySelectorAll('.remove-from-fav').forEach(button => {
            button.addEventListener('click', function() {
                const path = this.dataset.filepath;
                favoritesManager.removeFavorite(path);
                renderFavorites(); // Re-render the list
            });
        });
    }

    if (favoritesManager && typeof favoritesManager.getFavorites === 'function') {
        renderFavorites();
    } else {
        console.error("FavoritesManager is not available. Ensure favorites.js is loaded before this script block.");
        if (emptyMessage) {
            emptyMessage.textContent = "æ— æ³•åŠ è½½æ”¶è—åŠŸèƒ½ã€‚";
            emptyMessage.style.display = 'block';
        }
    }
});
</script>
{% endblock %}
